<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HidroCalc | Dimensionamento de Piscinões</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.3/jspdf.plugin.autotable.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        hydro: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            800: '#075985',
                            900: '#0c4a6e',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-slate-50 text-slate-800 antialiased pb-20">

    <div id="privacy-banner" class="fixed top-0 left-0 w-full bg-hydro-900 text-white text-xs py-2 px-4 z-50 flex justify-between items-center hidden">
        <div class="flex items-center gap-2">
            <i data-lucide="shield-check" class="w-4 h-4 text-green-400"></i>
            <span>Seus dados são processados localmente no navegador. Nenhuma informação é enviada para servidores.</span>
        </div>
        <button id="close-banner" class="hover:text-hydro-100"><i data-lucide="x" class="w-4 h-4"></i></button>
    </div>

    <header class="bg-white border-b border-slate-200 sticky top-0 z-40 mt-0">
        <div class="w-full max-w-none px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <div class="bg-hydro-600 p-2 rounded-lg">
                    <i data-lucide="waves" class="w-6 h-6 text-white"></i>
                </div>
                <div>
                    <h1 class="text-lg font-bold text-slate-900 leading-none">HidroCalc</h1>
                    <p class="text-xs text-slate-500 font-medium">Dimensionamento de Piscinões</p>
                </div>
            </div>
            <div class="flex gap-2">
                <button id="btn-reset" class="p-2 hover:bg-slate-100 rounded-full text-slate-600 transition-colors" title="Limpar Projeto">
                    <i data-lucide="rotate-ccw" class="w-5 h-5"></i>
                </button>
                <button id="btn-export" class="p-2 hover:bg-slate-100 rounded-full text-slate-600 transition-colors" title="Exportar JSON">
                    <i data-lucide="download" class="w-5 h-5"></i>
                </button>
                <button id="btn-methodology" class="p-2 hover:bg-slate-100 rounded-full text-slate-600 transition-colors" title="Ver Metodologia">
                    <i data-lucide="book-open" class="w-5 h-5"></i>
                </button>
                <button id="btn-print" class="p-2 hover:bg-hydro-50 rounded-full text-hydro-600 transition-colors" title="Gerar Relatório PDF">
                    <i data-lucide="file-text" class="w-5 h-5"></i>
                </button>
            </div>
        </div>
    </header>

    <main class="w-full px-4 sm:px-6 lg:px-8 py-8 grid grid-cols-1 2xl:grid-cols-12 gap-8">
        
        <div class="2xl:col-span-4 space-y-6">
            
            <section class="bg-white rounded-2xl shadow-sm border border-slate-100 p-6 transition-all hover:shadow-md">
                <div class="flex items-center gap-2 mb-4 border-b border-slate-100 pb-2">
                    <i data-lucide="map" class="w-5 h-5 text-hydro-600"></i>
                    <h2 class="font-semibold text-slate-800">Área & Ocupação</h2>
                </div>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1 flex items-center gap-1">
                            Área de Contribuição
                            <i data-lucide="info" class="w-3 h-3 text-slate-400 cursor-help tooltip-trigger" data-tip="Área total da bacia (A). Insira em ha, m² ou km²."></i>
                        </label>
                        <div class="flex rounded-md shadow-sm">
                            <input type="number" id="input-area" class="flex-1 block w-full rounded-l-md border-slate-300 focus:border-hydro-500 focus:ring-hydro-500 sm:text-sm p-2 border" placeholder="0.00">
                            <select id="select-unit" class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-slate-300 bg-slate-50 text-slate-500 sm:text-sm">
                                <option value="ha">ha</option>
                                <option value="m2">m²</option>
                                <option value="km2">km²</option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1 flex justify-between">
                            <span class="flex items-center gap-1">
                                Coeficiente de Runoff (C)
                                <i data-lucide="info" class="w-3 h-3 text-slate-400 cursor-help tooltip-trigger" data-tip="Razão Impermeável. Método Racional: Q = CIA/360."></i>
                            </span>
                            <span id="val-c" class="text-hydro-600 font-bold">0.75</span>
                        </label>
                        <input type="range" id="slider-c" min="0.1" max="1.0" step="0.01" value="0.75" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-hydro-600">
                        <div class="flex justify-between text-xs text-slate-400 mt-1">
                            <span>Parque (0.2)</span>
                            <span>Residencial (0.6)</span>
                            <span>Asfalto (0.95)</span>
                        </div>
                    </div>
                </div>
            </section>

            <section class="bg-white rounded-2xl shadow-sm border border-slate-100 p-6 transition-all hover:shadow-md">
                <div class="flex items-center gap-2 mb-4 border-b border-slate-100 pb-2">
                    <i data-lucide="cloud-rain" class="w-5 h-5 text-hydro-600"></i>
                    <h2 class="font-semibold text-slate-800">Hidrologia (IDF & Tc)</h2>
                </div>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Localidade (Equação IDF)</label>
                        <select id="select-city" class="block w-full rounded-md border-slate-300 border shadow-sm focus:border-hydro-500 focus:ring-hydro-500 sm:text-sm p-2">
                            <option value="custom">Personalizado</option>
                        </select>
                    </div>

                    <div id="idf-params" class="grid grid-cols-4 gap-2 p-3 bg-slate-50 rounded-md border border-slate-200 hidden">
                        <div><label class="text-xs text-slate-500">K</label><input type="number" id="idf-k" class="w-full text-xs p-1 border rounded"></div>
                        <div><label class="text-xs text-slate-500">a</label><input type="number" id="idf-a" class="w-full text-xs p-1 border rounded"></div>
                        <div><label class="text-xs text-slate-500">b</label><input type="number" id="idf-b" class="w-full text-xs p-1 border rounded"></div>
                        <div><label class="text-xs text-slate-500">c</label><input type="number" id="idf-c" class="w-full text-xs p-1 border rounded"></div>
                        <div class="col-span-4 text-[10px] text-slate-400 text-center font-mono">i = K·TR^a / (t + b)^c</div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1 flex justify-between">
                            <span class="flex items-center gap-1">
                                Tempo de Recorrência (TR)
                                <i data-lucide="info" class="w-3 h-3 text-slate-400 cursor-help tooltip-trigger" data-tip="Período de Retorno (Anos). NBR recomenda 10-25 anos para microdrenagem."></i>
                            </span>
                            <span class="text-hydro-600 font-bold"><span id="val-tr">25</span> anos</span>
                        </label>
                        <input type="range" id="slider-tr" min="2" max="100" step="1" value="25" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-hydro-600">
                    </div>

                    <div class="pt-2 border-t border-slate-100">
                        <div class="flex items-center justify-between mb-2">
                            <label class="text-sm font-medium text-slate-700 flex items-center gap-1">
                                Tempo de Concentração
                                <i data-lucide="info" class="w-3 h-3 text-slate-400 cursor-help tooltip-trigger" data-tip="Kirpich: tc = 0.0195 * L^0.77 * S^-0.385 (min). Mínimo recomendado 10min."></i>
                            </label>
                            <div class="flex items-center gap-2">
                                <input type="checkbox" id="check-calc-tc" class="rounded text-hydro-600 focus:ring-hydro-500 border-gray-300">
                                <span class="text-xs text-slate-500">Calcular (Kirpich)</span>
                            </div>
                        </div>
                        
                        <div id="tc-manual-group">
                            <div class="flex rounded-md shadow-sm">
                                <input type="number" id="input-tc" class="flex-1 block w-full rounded-l-md border-slate-300 border p-2 sm:text-sm" placeholder="10">
                                <span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-slate-300 bg-slate-50 text-slate-500 sm:text-sm">min</span>
                            </div>
                        </div>

                        <div id="tc-calc-group" class="hidden grid grid-cols-2 gap-2">
                            <div>
                                <label class="text-xs text-slate-500">Comprimento (L) [m]</label>
                                <input type="number" id="input-L" class="w-full p-2 border rounded-md text-sm">
                            </div>
                            <div>
                                <label class="text-xs text-slate-500">Desnível (H) [m]</label>
                                <input type="number" id="input-H" class="w-full p-2 border rounded-md text-sm">
                            </div>
                            <div class="col-span-2 text-xs text-slate-400 text-right" id="tc-result-display">Tc calculado: -- min</div>
                        </div>
                    </div>
                </div>
            </section>

            <section class="bg-white rounded-2xl shadow-sm border border-slate-100 p-6 transition-all hover:shadow-md">
                <div class="flex items-center gap-2 mb-4 border-b border-slate-100 pb-2">
                    <i data-lucide="settings-2" class="w-5 h-5 text-hydro-600"></i>
                    <h2 class="font-semibold text-slate-800">Cenário de Simulação</h2>
                </div>

                <div class="flex gap-2 bg-slate-100 p-1 rounded-lg mb-4">
                    <button class="flex-1 py-2 px-3 text-sm font-medium rounded-md shadow-sm bg-white text-hydro-700 transition-all" id="mode-volume">
                        Calc. Volume
                    </button>
                    <button class="flex-1 py-2 px-3 text-sm font-medium rounded-md text-slate-500 hover:text-slate-700 transition-all" id="mode-flow">
                        Eng. Reversa
                    </button>
                </div>

                <div id="input-container-limit">
                    <label class="block text-sm font-medium text-slate-700 mb-1 flex items-center gap-1">
                        Vazão de Saída Máxima
                        <i data-lucide="info" class="w-3 h-3 text-slate-400 cursor-help tooltip-trigger" data-tip="Vazão de restrição (pré-desenvolvimento). Define o volume necessário pelo método das chuvas."></i>
                    </label>
                    <div class="flex rounded-md shadow-sm">
                        <input type="number" id="input-limit-q" class="flex-1 block w-full rounded-l-md border-slate-300 border p-2 sm:text-sm" placeholder="ex: 50">
                        <span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-slate-300 bg-slate-50 text-slate-500 sm:text-sm">L/s</span>
                    </div>
                </div>

                <div id="input-container-volume" class="hidden">
                    <label class="block text-sm font-medium text-slate-700 mb-1 flex items-center gap-1">
                        Volume Disponível
                        <i data-lucide="info" class="w-3 h-3 text-slate-400 cursor-help tooltip-trigger" data-tip="Capacidade máxima do reservatório. Calcula a vazão de saída limite."></i>
                    </label>
                    <div class="flex rounded-md shadow-sm">
                        <input type="number" id="input-limit-v" class="flex-1 block w-full rounded-l-md border-slate-300 border p-2 sm:text-sm" placeholder="ex: 1000">
                        <span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-slate-300 bg-slate-50 text-slate-500 sm:text-sm">m³</span>
                    </div>
                </div>
            </section>

        </div>

        <div class="2xl:col-span-8 space-y-6">
            
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                <div class="bg-white p-4 rounded-xl border border-slate-100 shadow-sm hover:border-hydro-200 transition-colors">
                    <div class="text-xs font-medium text-slate-500 uppercase tracking-wider mb-1">Vazão de Pico (Entrada)</div>
                    <div class="flex items-baseline gap-1">
                        <span class="text-2xl font-bold text-slate-800" id="res-q-peak">--</span>
                        <span class="text-sm text-slate-500">L/s</span>
                    </div>
                    <div class="text-xs text-hydro-600 mt-2 flex items-center gap-1">
                        <i data-lucide="droplet" class="w-3 h-3"></i> Método Racional
                    </div>
                </div>

                <div class="bg-white p-4 rounded-xl border-l-4 border-l-hydro-500 shadow-sm">
                    <div class="text-xs font-medium text-slate-500 uppercase tracking-wider mb-1" id="label-main-result">Volume Útil</div>
                    <div class="flex items-baseline gap-1">
                        <span class="text-3xl font-bold text-hydro-700" id="res-volume">--</span>
                        <span class="text-sm text-slate-500">m³</span>
                    </div>
                    <div class="text-xs text-slate-400 mt-2 flex items-center gap-1">
                        <i data-lucide="box" class="w-3 h-3"></i> Método das Chuvas
                    </div>
                </div>

                <div class="bg-white p-4 rounded-xl border border-slate-100 shadow-sm hover:border-hydro-200 transition-colors">
                    <div class="text-xs font-medium text-slate-500 uppercase tracking-wider mb-1">Duração Crítica</div>
                    <div class="flex items-baseline gap-1">
                        <span class="text-2xl font-bold text-slate-800" id="res-crit-time">--</span>
                        <span class="text-sm text-slate-500">min</span>
                    </div>
                    <div class="text-xs text-orange-500 mt-2 flex items-center gap-1">
                        <i data-lucide="clock" class="w-3 h-3"></i> Pior Cenário
                    </div>
                </div>
            </div>

            <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-100">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-semibold text-slate-700 text-sm">Curva de Volume Armazenado vs. Duração</h3>
                    <span class="text-xs text-slate-400 bg-slate-100 px-2 py-1 rounded">Envelope de Chuva</span>
                </div>
                <div class="relative h-64 w-full">
                    <canvas id="chart-volume"></canvas>
                </div>
            </div>

            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                <div class="flex items-center gap-2 mb-4 pb-2 border-b border-slate-100">
                    <i data-lucide="circle-dot" class="w-5 h-5 text-slate-600"></i>
                    <h3 class="font-semibold text-slate-800">Sugestão de Tubulação (NBR 8890)</h3>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                    <div>
                        <p class="text-xs text-slate-500 mb-1">Saída (Restrição)</p>
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 rounded-full bg-slate-100 flex items-center justify-center border-4 border-slate-300 text-xs font-bold text-slate-600" id="pipe-out-icon">
                                --
                            </div>
                            <div>
                                <div class="font-bold text-lg text-slate-800"><span id="pipe-out-diam">--</span> mm</div>
                                <div class="text-xs text-green-600" id="pipe-out-vel">V = -- m/s</div>
                            </div>
                        </div>
                    </div>
                    <div class="opacity-75">
                        <p class="text-xs text-slate-500 mb-1">Entrada (Referência)</p>
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 rounded-full bg-slate-100 flex items-center justify-center border-4 border-slate-300 text-xs font-bold text-slate-600" id="pipe-in-icon">
                                --
                            </div>
                            <div>
                                <div class="font-bold text-lg text-slate-800"><span id="pipe-in-diam">--</span> mm</div>
                                <div class="text-xs text-green-600" id="pipe-in-vel">V = -- m/s</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-4 grid grid-cols-1 sm:grid-cols-3 gap-4">
                    <div>
                        <label class="text-xs text-slate-500">Declividade da Tubulação (S)</label>
                        <div class="flex rounded-md shadow-sm">
                            <input type="number" id="input-slope" class="flex-1 block w-full rounded-l-md border-slate-300 border p-2 sm:text-sm" placeholder="0.005">
                            <span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-slate-300 bg-slate-50 text-slate-500 sm:text-sm">m/m</span>
                        </div>
                    </div>
                    <div>
                        <label class="text-xs text-slate-500">Rugosidade de Manning (n)</label>
                        <div class="flex rounded-md shadow-sm">
                            <input type="number" id="input-n" class="flex-1 block w-full rounded-l-md border-slate-300 border p-2 sm:text-sm" placeholder="0.013" step="0.001">
                            <span class="inline-flex items-center px-3 rounded-r-md border border-l-0 border-slate-300 bg-slate-50 text-slate-500 sm:text-sm">-</span>
                        </div>
                    </div>
                    <div class="flex items-end">
                        <div class="text-[10px] text-slate-400 italic">Capacidade verificada por Manning a plena seção.</div>
                    </div>
                </div>
                <div class="mt-4 text-[10px] text-slate-400 italic">
                    *Diâmetro comercial mínimo para velocidade < 5 m/s.
                </div>
            </div>

        </div>
    </main>

    <div id="tooltip" class="fixed hidden bg-slate-800 text-white text-xs p-2 rounded shadow-lg z-50 max-w-xs pointer-events-none transition-opacity opacity-0"></div>

    <script type="module" src="main.js"></script>

    <div id="modal-methodology" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm hidden items-center justify-center z-50">
        <div class="bg-white rounded-2xl shadow-xl w-[min(90vw,1000px)] max-h-[80vh] overflow-auto">
            <div class="p-4 border-b border-slate-200 flex justify-between items-center">
                <h3 class="font-semibold text-slate-800">Metodologia</h3>
                <button id="close-methodology" class="p-2 rounded hover:bg-slate-100"><i data-lucide="x" class="w-4 h-4"></i></button>
            </div>
            <div class="p-6 space-y-4 text-sm text-slate-700">
                <p>Utiliza-se o Método Racional para estimar a vazão de pico e o Método das Chuvas (Envelope) para determinar o volume de detenção.</p>
                <p>A intensidade é obtida por i = K·TR^a / (t + b)^c, conforme equação IDF da localidade. O tempo de concentração pode ser estimado por Kirpich.</p>
                <p>Para tubulações, adota-se escoamento por gravidade com verificação pela fórmula de Manning: Q = (1/n) · A · R_h^{2/3} · S^{1/2}, assumindo n=0.013 para concreto.</p>
                <p>Normas de referência brasileiras: práticas de microdrenagem urbana e diretrizes de projeto aplicáveis.</p>
            </div>
        </div>
    </div>
</body>
</html>
